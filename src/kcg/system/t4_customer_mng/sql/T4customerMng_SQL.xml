<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace='system.t4_customer_mng'>
	<select id="getAllCustomers" parameterType="cmmnMap"
		resultType="cmmnMap">
		select *
		FROM kcgbd.db4_customer_info cust join kcgbd.db4_cust_con dcc on
		cust.customer_id = dcc.customer_id where cust.use_yn = 'Y';
	</select>
	<update id="deleteCust" parameterType="cmmnMap">
		update
		kcgbd.db4_customer_info
		set use_yn = 'N'
		where customer_id =
		CAST(#{customer_id} AS integer)
	</update>

	<update id="updateCust" parameterType="cmmnMap">
		update
		kcgbd.db4_customer_info
		set
		customer_name = #{customer_name},
		customer_level = #{customer_level},
		customer_phone
		= #{customer_phone},
		customer_sub_tel = #{customer_sub_tel},
		customer_email =
		#{customer_email},
		customer_job = #{customer_job},
		customer_addr =
		#{customer_addr}
		where customer_id =
		CAST(#{customer_id} AS integer)
	</update>

	<insert id="addCust" parameterType="cmmnMap">
		INSERT INTO
		kcgbd.db4_customer_info(
		customer_name
		,customer_id_number
		,customer_brdt
		
		,customer_phone
		,customer_sub_tel
		,customer_email
		,customer_job
		,customer_addr
		,customer_sub_date
		,user_id
		,use_yn
		)VALUES(
		#{customer_name}
		,#{customer_id_number}
		,substring(#{customer_id_number}, 1, 6)
		
		,#{customer_phone}
		,#{customer_sub_tel}
		,#{customer_email}
		,#{customer_job}
		,#{customer_addr}
		,CURRENT_DATE
		,#{user_id}
		,'Y'
		)
	</insert>
	<select id="getAllconsult" parameterType="cmmnMap"
		resultType="cmmnMap">
		SELECT
		con.*,
		tu.*,
		cc.*,
		ci.*,
		rep.name AS representative_name
		FROM
		kcgbd.db4_consult con
		JOIN
		kcgbd.t_user tu ON con.user_id =
		tu.user_id
		JOIN
		kcgbd.db4_cust_con cc ON con.con_id = cc.con_id
		JOIN
		kcgbd.db4_customer_info ci ON cc.customer_id = ci.customer_id
		JOIN
		kcgbd.t_user rep ON ci.user_id = rep.user_id
		WHERE
		con.user_id =
		#{user_id};
	</select>
	
	<insert id="addConsult" parameterType="cmmnMap">
		INSERT INTO
		kcgbd.db4_consult(
		con_date,
		user_id,
		consult_title,
		consult_context,
		con_id
		)VALUES(
		TO_CHAR(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'),
		#{user_id},
		#{consult_title},
		#{consult_context},
		CAST(#{con_id} AS integer)
		)
	</insert>
	
</mapper>